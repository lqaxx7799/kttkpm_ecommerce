{% extends 'homebase.html' %}
{% load static %}
{% block title %} {{ product.ten }} {% endblock %}

{% block head %}
  <script src="/static/js/jquery-2.2.4.min.js"></script>
{% endblock %}

{% block sidebar %} {% include 'sidebar.html' %} {% endblock %}

{% block body %}
    <!-- BREADCRUMB -->
    <div id="breadcrumb">
        <div class="container">
            <ul class="breadcrumb">
                <li><a href="/">Home</a></li>
                <!--<li><a href="/category/{{ product.category.id }}/{{ product.category.slug }}">{{ product.category.title }}</a></li>
                -->
                <li><a href="/home/category/{{ product.type }}">{{ product.type }}</a></li>
                <li class="active">{{ product.ten }}</li>
            </ul>
        </div>
    </div>
    <!-- /BREADCRUMB -->

    <!-- section -->
    <div class="section">
        <!-- container -->
        <div class="container">
            <!-- row -->
            <div class="row">
                <!--  Product Details -->
                <div class="product product-details clearfix">
                    <div class="col-md-6">
                        <div id="product-main-view">
                            <div class="product-view">
                                <img src="{{ product.imageURL }}" alt="" style="height: 400px">
                            </div>
                            {% for image in images %}
                                <div class="product-view">
                                    <img src="{{ image.urlimage.url }}" alt="" style="height: 400px">
                                </div>
                            {% endfor %}
                        </div>
                        <div id="product-view">
                            <div class="product-view">
                                <img src="{{ product.imageURL }}" alt="">
                            </div>
                            {% for image in images %}
                                <div class="product-view">
                                    <img src="{{ image.urlimage.url }}" alt="aa" >
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="product-body">
                            <div class="product-label">
                                <span>New</span>
                                <span class="sale">-20%</span>
                            </div>
                            <h2 class="product-name">{{ product.ten }}</h2>
                            <div>
                                <div class="product-rating">
                                    <i class="fa fa-star{% if product.avaregereview < 1%}-o empty{% endif%}"></i>
                                    <i class="fa fa-star{% if product.avaregereview < 2%}-o empty{% endif%}"></i>
                                    <i class="fa fa-star{% if product.avaregereview < 3%}-o empty{% endif%}"></i>
                                    <i class="fa fa-star{% if product.avaregereview < 4%}-o empty{% endif%}"></i>
                                    <i class="fa fa-star{% if product.avaregereview < 5%}-o empty{% endif%}"></i>
                                    {{ product.avaregereview |stringformat:".2f"}}
                                </div>
                                <a onclick="toReview()" href="#tab2"> {{ product.countreview}}  Review(s) / Add Review</a>
                            </div>
                            {% if product.type == "Book" %}
                            <p><strong>Tác giả:</strong> <a href="#" style = "color: blue">Keigo</a> </p>
                            {% else %}
                            <p><strong>Thương hiệu:</strong> <a href="#" style = "color: blue">ABCXYZ</a> </p>
                            {% endif %}
                            <p>{{ product.mota | safe }}</p>
                            
                            <div class="product-btns">
                                <form action="/addtoshopcart" method="post"  id="post-form">
                                    {% csrf_token %}
                                    <div id="SelectedProduct">
                                        <p>
                                            <strong>Còn lại:</strong> 
                                            <span id ="remain" style="color: red"></span> 
                                        </p>
                                        <h3 class="product-price" id="price" >{{product.gia}} VND</h3>
                                        {% if colors %}
                                            <p style="color:gray; font-size: 12pt;font-family: Arial">
                                                Chọn màu: 
                                                <span id = "color" style="color: rgb(36, 36, 36);font-weight: 500;"></span>
                                            </p>
                                            {% for cl in colors %}
                                            <span class = "color-span" style="background-color:{{cl}};" data-color="{{cl}}" onClick="selectColor(this.dataset.color)" ></span>
                                            {% endfor %}
                                        {% endif %}
                                        {% if sizes %}
                                            <p style="color:gray; font-size: 12pt;font-family: Arial">
                                                Chọn size: 
                                                <span id = "size" style="color: rgb(36, 36, 36);font-weight: 500;"></span>
                                            </p>
                                            <div class = "list-group" style="width: 400px">
                                            {% for size in sizes %}
                                                <span class = "size-span list-group-item" data-size="{{size}}" onClick="selectSize(this.dataset.size)">{{size}}</span>
                                            {% endfor %}
                                            </div>
                                        {% endif %}


                                        {% if discounts|length > 0 %}
                                            <div id="discount_quantity" style="font-size: 17px;font-weight: 1000;color: rgb(36, 36, 36);margin-bottom:10px;cursor: pointer;">
                                                {{discounts|length}} Mã Giảm Giá 
                                            </div>
                                        {% endif %}
                                        {% for discount in discounts %}
                                            <span class="coupon"
                                                 data-hsd="{{discount.discountid.hsd}}" 
                                                 data-requiree="{{discount.discountid.requiree}}" 
                                                 data-discountvalue="{{discount.discountid.value}}" 
                                                 onClick="DiscountDetail(this.dataset.hsd, this.dataset.requiree, this.dataset.discountvalue)">
                                                 Giảm {{discount.discountid.value}}K
                                            </span>
                                        {% endfor %}
                                        <br>
                                        <div class="qty-input" style="margin-top: 20px">
                                            <span class="text-uppercase">Amount: </span>
                                            <input class="input" name="soluong" type="number" value="1" min="1" max="{{ product.amount }}">
                                            <input class="input" name="variant_id" id = "variantId" type="hidden">
                                            <button type="submit" class="primary-btn add-to-cart" id="addToCart">
                                                <i class="fa fa-shopping-cart"></i> Add to Cart
                                            </button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                            <br>
                                <div class="pull-right">
                                    <button class="main-btn icon-btn"><i class="fa fa-heart"></i></button>
                                    <button class="main-btn icon-btn"><i class="fa fa-exchange"></i></button>
                                    <button class="main-btn icon-btn"><i class="fa fa-share-alt"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-12">
                        <div class="product-tab">
                            <ul class="tab-nav" id = "mytabs">
                                <li class="active"><a data-toggle="tab" href="#tab1">CHI TIẾT SẢN PHẨM</a></li>
                                <li><a data-toggle="tab" href="#tab2">ĐÁNH GIÁ</a></li>
                                <li><a data-toggle="tab" href="#tab3">HỎI ĐÁP</a></li>
                            </ul>

                            <!-- Detail -->
                            <div class="tab-content">
                                <div id="tab1" class="tab-pane fade in active">
                                    <p>
                                        {{ product.chitietsp | safe}}
                                    </p>
                                </div>
                                <!-- End Detail -->

                                <!-- Review  -->
                                <div id="tab2" class="tab-pane fade in">

                                    <div class="row">
                                        <div class="col-md-6">
                                            <div id = "review" class="product-reviews">
                                                {% for review in reviews %}
                                                    <div class="single-review">
                                                        <div class="review-heading">
                                                            <div>
                                                                <a href="#">
                                                                    <i class="fa fa-user-o">
                                                                    </i> 
                                                                    {{ review.taikhoanid.first_name }}
                                                                    {{ review.taikhoanid.last_name }}
                                                                </a> 
                                                            </div>

                                                            <div>
                                                                <b>{{ review.subject }}</b> 
                                                            </div>

                                                            <div>
                                                                <a href="#">
                                                                    <i class="fa fa-clock-o"></i> 
                                                                    {{ review.createdat }}
                                                                </a>
                                                            </div>

                                                            <div class="review-rating pull-right">
                                                                <i class="fa fa-star{% if review.rating < 1 %}-o empty{% endif %}"></i>
                                                                <i class="fa fa-star{% if review.rating < 2 %}-o empty{% endif %}"></i>
                                                                <i class="fa fa-star{% if review.rating < 3 %}-o empty{% endif %}"></i>
                                                                <i class="fa fa-star{% if review.rating < 4 %}-o empty{% endif %}"></i>
                                                                <i class="fa fa-star{% if review.rating < 5 %}-o empty{% endif %}"></i>

                                                            </div>
                                                        </div>

                                                        <div class="review-body">
                                                            <p>{{ review.noidung }}</p>
                                                        </div>

                                                    </div>
                                                {% endfor %}
                                            </div>
                                            <ul class="reviews-pages">
                                                {% for num in reviews.paginator.page_range %}
                                                <li class="rp" id="rv{{num}}" onClick="changePage(this.id)" style="cursor: pointer;">{{ num }}</li>
                                                {% endfor %}
                                            </ul>
                                        </div>
                                        <div class="col-md-6">
                                            <h4 class="text-uppercase">Write Your Review</h4>
                                            <form class="review-form" action="/addreview/{{ product.id }}" method="post">
                                                {% csrf_token %}
                                                <div class="form-group">
                                                    <input name="subject" class="input" type="text" placeholder="Your subject" />
                                                </div>

                                                <div class="form-group">
                                                    <textarea name="noidung" class="input" placeholder="Your review"></textarea>
                                                </div>
                                                <div class="form-group">
                                                    <div class="input-rating">
                                                        <strong class="text-uppercase">Your Rating: </strong>
                                                        <div class="stars">
                                                            <input type="radio" id="star5" name="rating" value="5" /><label for="star5"></label>
                                                            <input type="radio" id="star4" name="rating" value="4" /><label for="star4"></label>
                                                            <input type="radio" id="star3" name="rating" value="3" /><label for="star3"></label>
                                                            <input type="radio" id="star2" name="rating" value="2" /><label for="star2"></label>
                                                            <input type="radio" id="star1" name="rating" value="1" /><label for="star1"></label>
                                                        </div>
                                                    </div>
                                                </div>
                                                {% if user.id is None %}
                                                    You must be logged in to post a review
                                                {% else %}
                                                    <button class="primary-btn">Submit</button>
                                                {% endif %}
                                            </form>
                                        </div>
                                    </div>
                                </div>
                                <!-- End Review -->

                                <!-- Comment -->
                                 <div id="tab3" class="tab-pane fade in">
                                    <div class="comments-container">
                                        <ul id="comments-list" class="comments-list">

                                        {% for comment in comments %}
                                          <li>
                                            <div class="comment-main-level">

                                              <!-- Avatar -->
                                              <div class="comment-avatar">
                                                <img src="{{comment.user_profile.image.url}}" alt="">
                                              </div>

                                              <!-- Contenedor del Comentario -->
                                              <div class="comment-box">
                                                <div class="comment-head">
                                                  <h6 class="comment-name"><a href="#">{{ comment.user_profile.hovaten }}</a></h6>
                                                  <span>{{ comment.createdat }}</span>
                                                  <i data-replybox="panel{{comment.id}}" class="fa fa-reply" onClick="reply(this.dataset.replybox)">&nbsp;Trả lời</i>
                                                </div>
                                                <div class="comment-content">
                                                  {{ comment.noidung }}
                                                </div>
                                              </div>
                                            </div> 
                                            <div class = "replybox" id="panel{{comment.id}}">
                                                <form class="review-form" action="/addcommentreply/{{comment.id}}" method="post">
                                                    {% csrf_token %}
                                                    <div class="form-group" style="width: 700px">
                                                        <textarea name="noidung" class="input" placeholder="Your Reply"></textarea>
                                                    </div>
                                                    {% if user.id is not None %}
                                                        <button class="primary-btn">Submit</button>
                                                    {% else %}
                                                        You must be logged in to post a reply
                                                    {% endif %}
                                                    <button class="primary-btn cancelbutton" type="button" onClick="cancelreply()">Cancel</button>
                                                </form>
                                            </div>
                                            <!-- Respuestas de los comentarios -->
                                            <ul class="comments-list reply-list">

                                            {% for reply in commentReplys %}
                                                {% if reply.productcommentid == comment %}
                                              <li>
                                                <!-- Avatar -->
                                                <div class="comment-avatar">
                                                    <img src="{{reply.user_profile.image.url}}" alt="">
                                                </div>
                                                
                                                <!-- Contenedor del Comentario -->
                                                <div class="comment-box">
                                                  <div class="comment-head">
                                                    <h6 class="comment-name"><a href="#">{{reply.user_profile.hovaten}}</a></h6>
                                                    <span>{{reply.createdat}}</span>
                                                    <i data-replybox="panelrep{{comment.id}}" class="fa fa-reply" onClick="reply(this.dataset.replybox)">&nbsp;Trả lời</i>
                                                  </div>
                                                  <div class="comment-content">
                                                    {{reply.noidung}}
                                                  </div>
                                                </div>
                                              </li>

                                                <div class = "replybox" id="panelrep{{comment.id}}">
                                                    <form class="review-form" action="/addcommentreply/{{comment.id}}" method="post">
                                                        {% csrf_token %}
                                                        <div class="form-group" style="width: 700px">
                                                            <textarea name="noidung" class="input" placeholder="Your Reply"></textarea>
                                                        </div>
                                                        {% if user.id is not None %}
                                                            <button class="primary-btn">Submit</button>
                                                        {% else %}
                                                            You must be logged in to post a reply
                                                        {% endif %}
                                                        <button class="primary-btn cancelbutton" type="button" onClick="cancelreply()">Cancel</button>
                                                    </form>
                                                </div>
                                                {% endif %}
                                              {% endfor %}
                                            </ul>
                                          </li>
                                          {% endfor %}
                                        </ul>
                                      </div>
                                    <ul class="reviews-pages">
                                        {% for num in comments.paginator.page_range %}
                                        <li class="cp" id="cm{{num}}" onClick="changePage(this.id)" style="cursor: pointer;">{{ num }}</li>
                                        {% endfor %}
                                    </ul>
                                        <div class="col-md-6" style="margin-top: 20px">
                                            <h4 class="text-uppercase">Write Your Comment</h4>
                                            <form class="review-form" action="/addcomment/{{ product.id }}" method="post">
                                                {% csrf_token %}
                                                <div class="form-group" style="width: 800px">
                                                    <textarea name="noidung" class="input" placeholder="Your Comment"></textarea>
                                                </div>
                                                {% if user.id is not None %}
                                                    <button class="primary-btn">Submit</button>
                                                {% else %}
                                                    You must be logged in to post a comment
                                                {% endif %}
                                            </form>

                                        </div>
                                    </div>
                                <!-- End Comment-->
                            </div>
                        </div>
                    </div>

                </div>
                <!-- /Product Details -->
            </div>
            <!-- /row -->
        </div>
        <!-- /container -->
    </div>
    <!-- /section -->

    <!-- Button trigger modal -->
        <!-- Modal -->
        <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content" style="width:65vh;">

            <div class="modal_header" style="margin-bottom:5vh;">

                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true" style="margin-right:10px">&times;</span>
                </button>

                 <div style="font-size: 25px;font-weight: 1000;line-height: 1.4;text-align:center;margin-top:10px">Mã giảm giá</div>

            </div>
            
            {% for discount in discounts %}
            <div class="modal-body" style="height:25vh;width:50vh">
                <div class="coupon_line" style="margin-left:50px">
                    <div class="coupon_left">
                        <div class="img_logo_store">
                            <a href="#" aria-label="LANITH STORE-link">
                                <div>
                                    <img src="https://vcdn.tikicdn.com/cache/64x64/ts/seller/86/57/65/8c8732166903e1260ebbfdbe7ee890bb.jpg" alt="LANITH STORE" opacity="1">
                                </div>
                            </a>
                        </div>
                        <div class="store_name_div">
                            <p class="store_name_p">STORE NAME</p>
                        </div>
                    </div>
                    <div class="coupon_right">
                        <button class="button_info" aria-describedby="popup-1"><img class="" src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20xmlns%3Axlink%3D%22http%3A%2F%2Fwww.w3.org%2F1999%2Fxlink%22%20width%3D%2220%22%20height%3D%2220%22%20viewBox%3D%220%200%2020%2020%22%3E%20%20%20%20%3Cdefs%3E%20%20%20%20%20%20%20%20%3Cpath%20id%3D%224gg7gqe5ua%22%20d%3D%22M8.333%200C3.738%200%200%203.738%200%208.333c0%204.595%203.738%208.334%208.333%208.334%204.595%200%208.334-3.739%208.334-8.334S12.928%200%208.333%200zm0%201.026c4.03%200%207.308%203.278%207.308%207.307%200%204.03-3.278%207.308-7.308%207.308-4.03%200-7.307-3.278-7.307-7.308%200-4.03%203.278-7.307%207.307-7.307zm.096%206.241c-.283%200-.512.23-.512.513v4.359c0%20.283.23.513.512.513.284%200%20.513-.23.513-.513V7.78c0-.283-.23-.513-.513-.513zm.037-3.114c-.474%200-.858.384-.858.858%200%20.473.384.857.858.857s.858-.384.858-.857c0-.474-.384-.858-.858-.858z%22%2F%3E%20%20%20%20%3C%2Fdefs%3E%20%20%20%20%3Cg%20fill%3D%22none%22%20fill-rule%3D%22evenodd%22%3E%20%20%20%20%20%20%20%20%3Cg%3E%20%20%20%20%20%20%20%20%20%20%20%20%3Cg%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cg%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cg%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cg%20transform%3D%22translate%28-2808%20-4528%29%20translate%282708%2080%29%20translate%2852%204304%29%20translate%2848%20144%29%20translate%281.667%201.667%29%22%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cuse%20fill%3D%22%23017FFF%22%20xlink%3Ahref%3D%22%234gg7gqe5ua%22%2F%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3C%2Fg%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3C%2Fg%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3C%2Fg%3E%20%20%20%20%20%20%20%20%20%20%20%20%3C%2Fg%3E%20%20%20%20%20%20%20%20%3C%2Fg%3E%20%20%20%20%3C%2Fg%3E%3C%2Fsvg%3E" alt="info-icon"></button>
                        <div style="padding-right: 28px;">
                            <h4 class="coupon_value">Giảm {{ discount.discountid.value }}K</h4>
                            <p class="coupon_require">Cho đơn hàng từ {{ discount.discountid.requiree }}K</p>
                        </div>
                        <br>    
                        <div style="margin-top: auto;display: flex;align-items: flex-end;">
                            <p class="coupon_hsd" style="padding-right: 8px;">HSD: {{discount.discountid.hsd}}</p>
                            <button class="button_luu" type="primary" style="margin-left:auto;white-space: nowrap;">Lưu</button>
                        </div>
                    </div>
                </div>  
            </div>
             {% endfor %}

            </div>
        </div>
        </div>
        <!-- Button trigger modal -->
    <script type="text/javascript">
        /* ajax to change page review/comment  */
        $('#rv1').addClass("active");
        $('#cm1').addClass("active");
        function changePage(id){
            let page = id.substring(2,3);
            let type =  id.substring(0,2);
            if(type == "rv"){
                $('.rp').removeClass("active");
                $('#'+id).addClass("active");
                $.ajax({
                    type: 'get',
                    url: '/product/'+"{{product.id}}"+'/'+"{{product.slug}}"+'/', 
                    data: {page: page, type: type},
                    success: function(data){
                        let out='';
                        $.each(data.review_li, function(index, review){
                            out += '<div class="single-review">';
                            out +='<div class="review-heading">';
                            out += '<div> <a href="#"><i class="fa fa-user-o"></i> '+review.taikhoanid__first_name+' '+review.taikhoanid__last_name+'</a> </div>';
                            out += '<div><b>'+ review.subject +'</b> </div>';
                            out += '<div><a href="#"><i class="fa fa-clock-o"></i> '+review.createdat+'</a></div> \n';
                            out +='<div class="review-rating pull-right"> \n';
                            for(var i = 1; i<=5; i++){
                                if( review.rating >= i)
                                    out +='<i class="fa fa-star"></i> \n';
                                else
                                    out +='<i class="fa fa-star-o empty"></i> \n';
                            }
                            out += '</div> \n';
                            out += '</div> \n';
                            out += '<div class="review-body"><p>'+review.noidung+'</p></div> \n';
                            out += '</div>';
                        })
                        $('#review').html(out);
                    }
                })
            }
            if(type == "cm"){
                $('.cp').removeClass("active");
                $('#'+id).addClass("active");
                $.ajax({
                    type: 'get',
                    url: '/product/'+"{{product.id}}"+'/'+"{{product.ten}}"+'/', 
                    data: {page: page, type: type},
                    success: function(data){
                        let out='';
                        $.each(data.comment_li, function(index, comment){
                            out += '<li>';
                            out +='<div class="comment-main-level">';
                            out +='<div class="comment-avatar"><img src="http://localhost:8000/images/'+comment.user_profile__image+'" alt=""></div>';
                            out += '<div class="comment-box">';
                            out +='<div class="comment-head">';
                            out +='<h6 class="comment-name"><a href="#">'+comment.user_profile__hovaten+'</a></h6>';
                            out +='<span>'+comment.createdat+'</span>';
                            out +='<i data-replybox ="panel'+comment.id+'" class="fa fa-reply" onClick="reply(this.dataset.replybox)"></i> <i class="fa fa-heart"></i> </div>';
                            out += '<div class="comment-content">'+comment.noidung+'</div> </div> </div>';
                            out += '<div class = "replybox" id="panel'+comment.id+'">';
                            out +='<form class="review-form" action="/addcommentreply/'+comment.id+'" method="post">';
                            out +='{% csrf_token %}';
                            out +='<div class="form-group" style="width: 700px"> <textarea name="noidung" class="input" placeholder="Your Reply"></textarea> </div> {% if user.id is not None %} <button class="primary-btn">Submit</button> {% else %} You must be logged in to post a reply {% endif %} <button class="primary-btn cancelbutton" type="button" onClick="cancelreply()">Cancel</button> </form> </div>';
                            out +='<ul class="comments-list reply-list">';
                            for(var i = 0; i< data.comment_rep.length; i++){
                                let reply = data.comment_rep[i];
                                if(reply.productcommentid_id == comment.id){
                                    out += '<li>';
                                    out += '<div class="comment-avatar"><img src="http://localhost:8000/images/'+reply.user_profile__image+'" alt=""></div>';
                                    out += '<div class="comment-box">';
                                    out +='<div class="comment-head">';
                                    out +='<h6 class="comment-name"><a href="#">'+reply.user_profile__hovaten+'</a></h6>';
                                    out += '<span>'+reply.createdat+'</span>';
                                    out += '<i data-replybox="panelrep'+comment.id+'" class="fa fa-reply" onClick="reply(this.dataset.replybox)"></i> <i class="fa fa-heart"></i> </div>';
                                    out +='<div class="comment-content">'+reply.noidung+' </div> </div> </li>';
                                    out+='<div class = "replybox" id="panelrep'+comment.id+'">';
                                    out+=' <form class="review-form" action="/addcommentreply/'+comment.id+'" method="post">';
                                    out+=' {% csrf_token %} <div class="form-group" style="width: 700px"> <textarea name="noidung" class="input" placeholder="Your Reply"></textarea> </div> {% if user.id is not None %} <button class="primary-btn">Submit</button> {% else %} You must be logged in to post a reply {% endif %} <button class="primary-btn cancelbutton" type="button" onClick="cancelreply()">Cancel</button> </form> </div>';
                                }        
                            }
                            out+='</ul>';
                            out += '</li>';
                        });
                        $('#comments-list').html(out);
                    }
                })
            }
        }
    </script>

    <script type="text/javascript">
        var productAttribute1 = {{productAttributes|safe}};
        var variant1 = {{variants|safe}}
        $('#addToCart').attr('disabled', true);
        if(productAttribute1.length == 0){
            $('#remain').text(variant1[0].quantity +" sản phẩm");
            $('#price').text(variant1[0].price.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".")+" VND");
            $('#variantId').val(variant1[0].variant_id);
            $('#addToCart').attr('disabled', false);
        }
        
        /*  Change active item when select color and size  */
        
        $('.list-group-item').click(function(e) {
            e.preventDefault();
            $(this).addClass('active').siblings().removeClass('active');
        });

        /* change to tab review when click link  */
        function toReview(){
            $('#mytabs a[href="#tab2"]').tab('show');
        }

        /* show and hide reply box */
        function reply(id){
            $('.replybox').hide();
            $('#'+id).toggle();
        }
        function cancelreply(){
            $('.replybox').hide();
        }
        /* Select size and color  */
        function selectSize(size){
            $('#size').text(size);
            var variants = {{ variants|safe }};
            var variantValues = {{variantValues|safe}};
            var productAttribute = {{productAttributes|safe}};
            if (productAttribute.length > 1){
                if( $('#color').text() == ""){
                    $('#price').text("Chưa chọn color");
                    $('#remain').text("Chưa chọn color");
                }else if( $('#color').text() != ""){
                    var selectedColor = $('#color').text();
                    for(var i = 0; i< variants.length; i++){
                        item1 = variants[i];
                        var count = 0;
                        for(var j = 0; j < variantValues.length; j++){
                            item2 = variantValues[j];
                            if(item2.variant_id_id == item1.variant_id && (item2.value == size||item2.value == selectedColor))
                                count++;
                        }
                        if(count == 2){
                            $('#remain').text(item1.quantity +" sản phẩm");
                            $('#price').text(item1.price.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".")+" VND");
                            $('#addToCart').attr('disabled', false);
                            $('#variantId').val(item1.variant_id);
                            return;
                        }
                    }
                    $('#price').text("0 VND");
                    $('#remain').text("Sản phẩm này đã hết hàng !!");
                    $('#addToCart').attr('disabled', true);
                }
            }else if (productAttribute.length == 1){
                for( i = 0; i< variantValues.length; i++){
                    item = variantValues[i];
                    if(item.value == color){
                        for( j = 0; j<variants.length; j++){
                            if(variants[j].variant_id == item.variant_id_id){
                                $('#remain').text(variants[j].quantity +" sản phẩm");
                                $('#price').text(variants[j].price.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".")+" VND");
                                $('#addToCart').attr('disabled', false);
                                $('variantId').val(variants[j].variant_id);
                                break;
                            }
                        }
                        break;
                    }
                }
            }
        }

        function selectColor(color){
            $('#color').text(color);
            var variants = {{ variants|safe }};
            var variantValues = {{variantValues|safe}};
            var productAttribute = {{productAttributes|safe}};
            if (productAttribute.length > 1){
                if( $('#size').text() == ""){
                    $('#price').text("Chưa chọn size");
                    $('#remain').text("Chưa chọn size");
                }else if( $('#size').text() != ""){
                    var selectedSize = $('#size').text();
                    for(var i = 0; i< variants.length; i++){
                        item1 = variants[i];
                        var count = 0;
                        for(var j = 0; j < variantValues.length; j++){
                            item2 = variantValues[j];
                            if(item2.variant_id_id == item1.variant_id && (item2.value == color||item2.value == selectedSize))
                                count++;
                        }
                        if(count == 2){
                            $('#remain').text(item1.quantity +" sản phẩm");
                            $('#price').text(item1.price.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".")+" VND");
                            $('#addToCart').attr('disabled', false);
                            $('#variantId').val(item1.variant_id);
                            return;
                        }
                    }
                    $('#price').text("0 VND");
                    $('#remain').text("Sản phẩm này đã hết hàng !!");
                    $('#addToCart').attr('disabled', true);
                }
            }else if (productAttribute.length == 1){
                for( i = 0; i< variantValues.length; i++){
                    item = variantValues[i];
                    if(item.value == color){
                        for( j = 0; j<variants.length; j++){
                            if(variants[j].variant_id == item.variant_id_id){
                                $('#remain').text(variants[j].quantity +" sản phẩm");
                                $('#price').text(variants[j].price.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".")+" VND");
                                $('#addToCart').attr('disabled', false);
                                $('variantId').val(variants[j].variant_id);
                                break;
                            }
                        }
                        break;
                    }
                }
            }else{
                $('#remain').text(variants[0].quantity +" sản phẩm");
                $('#price').text(variants[0].price.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".")+" VND");
                $('#addToCart').attr('disabled', false);
                $('variantId').val(variants[0].variant_id);
            }

        }

        /**/
    </script>

    <script type="text/javascript">
    var discount_quantity = $('#discount_quantity')
    discount_quantity.click(function(){
        $('#myModal').modal('show');
    });
    
    var coupon = document.getElementsByClassName('coupon');
    for(i=0; i<coupon.length; i++){
        coupon[i].addEventListener('click', function(){
            $('#myModal').modal('show');
        });
    }

    </script>
{% endblock %}